"use strict";
(self["webpackChunk"] = self["webpackChunk"] || []).push([["vendors-node_modules_pnpm_flasher_flasher_1_0_11_node_modules_flasher_flasher_dist_index_js"],{

/***/ "./node_modules/.pnpm/@flasher+flasher@1.0.11/node_modules/@flasher/flasher/dist/index.js":
/*!************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@flasher+flasher@1.0.11/node_modules/@flasher/flasher/dist/index.js ***!
  \************************************************************************************************/
/***/ (function(module) {



var e=[],t=[];function n(n,r){if(n&&"undefined"!=typeof document){var a,s=!0===r.prepend?"prepend":"append",d=!0===r.singleTag,i="string"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName("head")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c();}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n));}function c(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a="prepend"===s?"afterbegin":"beforeend";return i.insertAdjacentElement(a,e),e}}

var css = ".fl-main-container{\n  position:fixed;\n  width:24rem;\n  z-index:99999;\n  transition:all 1s ease-in-out; }\n  .fl-main-container[data-position^=\"top-\"]{\n    top:0.5rem; }\n  .fl-main-container[data-position^=\"bottom-\"]{\n    bottom:0.5rem; }\n  .fl-main-container[data-position$=\"-right\"]{\n    right:0.5rem; }\n    .fl-main-container[data-position$=\"-right\"] .fl-container{\n      transform:translateX(110%); }\n  .fl-main-container[data-position$=\"-left\"]{\n    left:0.5rem; }\n    .fl-main-container[data-position$=\"-left\"] .fl-container{\n      transform:translateX(-110%); }\n  .fl-main-container[data-position$=\"-center\"]{\n    left:50%;\n    transform:translateX(-50%); }\n  .fl-main-container[data-position=\"top-center\"] .fl-container{\n    transform:translateY(-100vh); }\n  .fl-main-container[data-position=\"bottom-center\"] .fl-container{\n    transform:translateY(100vh); }\n\n.fl-main-container .fl-container{\n  transition:transform 0.3s ease-in-out; }\n  .fl-main-container .fl-container.fl-show{\n    transform:translate(0, 0); }\n\n.fl-main-container .fl-container.fl-success{\n  border-left:0.8rem solid #059669FF; }\n  .fl-main-container .fl-container.fl-success .fl-icon{\n    background-color:#059669FF; }\n  .fl-main-container .fl-container.fl-success .fl-title{\n    color:#059669FF; }\n  .fl-main-container .fl-container.fl-success .fl-progress-bar{\n    background-color:#6dface; }\n    .fl-main-container .fl-container.fl-success .fl-progress-bar .fl-progress{\n      background-color:#059669FF; }\n\n.fl-main-container .fl-container.fl-info{\n  border-left:0.8rem solid #2563EBFF; }\n  .fl-main-container .fl-container.fl-info .fl-icon{\n    background-color:#2563EBFF; }\n  .fl-main-container .fl-container.fl-info .fl-title{\n    color:#2563EBFF; }\n  .fl-main-container .fl-container.fl-info .fl-progress-bar{\n    background-color:#e0e9fc; }\n    .fl-main-container .fl-container.fl-info .fl-progress-bar .fl-progress{\n      background-color:#2563EBFF; }\n\n.fl-main-container .fl-container.fl-warning{\n  border-left:0.8rem solid #D97706FF; }\n  .fl-main-container .fl-container.fl-warning .fl-icon{\n    background-color:#D97706FF; }\n  .fl-main-container .fl-container.fl-warning .fl-title{\n    color:#D97706FF; }\n  .fl-main-container .fl-container.fl-warning .fl-progress-bar{\n    background-color:#fdd8ae; }\n    .fl-main-container .fl-container.fl-warning .fl-progress-bar .fl-progress{\n      background-color:#D97706FF; }\n\n.fl-main-container .fl-container.fl-error{\n  border-left:0.8rem solid #DC2626FF; }\n  .fl-main-container .fl-container.fl-error .fl-icon{\n    background-color:#DC2626FF; }\n  .fl-main-container .fl-container.fl-error .fl-title{\n    color:#DC2626FF; }\n  .fl-main-container .fl-container.fl-error .fl-progress-bar{\n    background-color:#f8d6d6; }\n    .fl-main-container .fl-container.fl-error .fl-progress-bar .fl-progress{\n      background-color:#DC2626FF; }\n\n.fl-main-container .fl-container .fl-icon{\n  position:relative;\n  width:1em;\n  height:1em;\n  margin:0;\n  border-radius:50%;\n  transition:all 1s;\n  box-sizing:border-box;\n  display:inline-block;\n  color:white; }\n  .fl-main-container .fl-container .fl-icon:before, .fl-main-container .fl-container .fl-icon:after{\n    content:\"\";\n    position:absolute;\n    transition:all 1s;\n    border-width:0;\n    box-sizing:border-box; }\n\n.fl-main-container .fl-container.fl-success .fl-icon:before, .fl-main-container .fl-container.fl-success .fl-icon:after{\n  width:0.16em;\n  height:0.6em;\n  background-color:currentColor;\n  border-radius:0.1em;\n  top:0.6em;\n  left:0.35em;\n  transform:rotate(-135deg);\n  transform-origin:0.08em 0.08em; }\n\n.fl-main-container .fl-container.fl-success .fl-icon:after{\n  width:0.4em;\n  height:0.16em; }\n\n.fl-main-container .fl-container.fl-info .fl-icon:before, .fl-main-container .fl-container.fl-info .fl-icon:after{\n  width:0.15em;\n  background-color:currentColor;\n  left:50%;\n  transform:translateX(-50%);\n  border-radius:0.03em; }\n\n.fl-main-container .fl-container.fl-info .fl-icon:before{\n  height:0.38em;\n  top:0.4em; }\n\n.fl-main-container .fl-container.fl-info .fl-icon:after{\n  height:0.13em;\n  box-shadow:-0.06em 0.19em, -0.06em 0.44em, 0.06em 0.44em;\n  top:0.21em; }\n\n.fl-main-container .fl-container.fl-warning .fl-icon:before, .fl-main-container .fl-container.fl-warning .fl-icon:after{\n  width:0.15em;\n  background-color:currentColor;\n  border-radius:0.03em;\n  left:50%;\n  transform:translateX(-50%); }\n\n.fl-main-container .fl-container.fl-warning .fl-icon:before{\n  height:0.38em;\n  top:0.21em; }\n\n.fl-main-container .fl-container.fl-warning .fl-icon:after{\n  height:0.13em;\n  top:0.65em; }\n\n.fl-main-container .fl-container.fl-error .fl-icon:before, .fl-main-container .fl-container.fl-error .fl-icon:after{\n  width:0.16em;\n  height:0.7em;\n  background-color:currentColor;\n  border-radius:0.1em;\n  transform:translate(-50%, -50%) rotate(-135deg);\n  top:50%;\n  left:50%; }\n\n.fl-main-container .fl-container.fl-error .fl-icon:after{\n  transform:translate(-50%, -50%) rotate(-45deg); }\n.fl-main-container .fl-container.fl-flasher{\n  font-family:-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n  line-height:1.5;\n  background-color:white;\n  color:#4b5563;\n  margin-top:0.5rem;\n  border-radius:0.375rem 0 0 0.375rem;\n  cursor:pointer;\n  box-shadow:0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  word-break:break-word; }\n  .fl-main-container .fl-container.fl-flasher .fl-content{\n    display:flex;\n    padding:0.75rem;\n    align-items:center; }\n  .fl-main-container .fl-container.fl-flasher .fl-icon{\n    font-size:2.5rem; }\n  .fl-main-container .fl-container.fl-flasher .fl-title, .fl-main-container .fl-container.fl-flasher .fl-message{\n    display:block;\n    margin-left:1rem;\n    line-height:1.25rem;\n    text-transform:capitalize; }\n  .fl-main-container .fl-container.fl-flasher .fl-title{\n    font-size:1rem;\n    font-weight:500; }\n  .fl-main-container .fl-container.fl-flasher .fl-message{\n    margin-top:0.25rem;\n    font-size:0.875rem; }\n  .fl-main-container .fl-container.fl-flasher .fl-progress-bar{\n    display:flex;\n    height:0.125rem;\n    margin-left:-1px; }\n\n.dark .fl-main-container .fl-flasher.fl-container{\n  background-color:#0f172a;\n  color:white; }\n\n@media (prefers-color-scheme: dark){\n  .fl-main-container .fl-flasher.fl-container{\n    background-color:#0f172a;\n    color:white; } }\n";
n(css,{});

/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __spreadArray(to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
}

var isMergeableObject = function isMergeableObject(value) {
	return isNonNullObject(value)
		&& !isSpecial(value)
};

function isNonNullObject(value) {
	return !!value && typeof value === 'object'
}

function isSpecial(value) {
	var stringValue = Object.prototype.toString.call(value);

	return stringValue === '[object RegExp]'
		|| stringValue === '[object Date]'
		|| isReactElement(value)
}

// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25
var canUseSymbol = typeof Symbol === 'function' && Symbol.for;
var REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;

function isReactElement(value) {
	return value.$$typeof === REACT_ELEMENT_TYPE
}

function emptyTarget(val) {
	return Array.isArray(val) ? [] : {}
}

function cloneUnlessOtherwiseSpecified(value, options) {
	return (options.clone !== false && options.isMergeableObject(value))
		? deepmerge(emptyTarget(value), value, options)
		: value
}

function defaultArrayMerge(target, source, options) {
	return target.concat(source).map(function(element) {
		return cloneUnlessOtherwiseSpecified(element, options)
	})
}

function getMergeFunction(key, options) {
	if (!options.customMerge) {
		return deepmerge
	}
	var customMerge = options.customMerge(key);
	return typeof customMerge === 'function' ? customMerge : deepmerge
}

function getEnumerableOwnPropertySymbols(target) {
	return Object.getOwnPropertySymbols
		? Object.getOwnPropertySymbols(target).filter(function(symbol) {
			return target.propertyIsEnumerable(symbol)
		})
		: []
}

function getKeys(target) {
	return Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))
}

function propertyIsOnObject(object, property) {
	try {
		return property in object
	} catch(_) {
		return false
	}
}

// Protects from prototype poisoning and unexpected merging up the prototype chain.
function propertyIsUnsafe(target, key) {
	return propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,
		&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,
			&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.
}

function mergeObject(target, source, options) {
	var destination = {};
	if (options.isMergeableObject(target)) {
		getKeys(target).forEach(function(key) {
			destination[key] = cloneUnlessOtherwiseSpecified(target[key], options);
		});
	}
	getKeys(source).forEach(function(key) {
		if (propertyIsUnsafe(target, key)) {
			return
		}

		if (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {
			destination[key] = getMergeFunction(key, options)(target[key], source[key], options);
		} else {
			destination[key] = cloneUnlessOtherwiseSpecified(source[key], options);
		}
	});
	return destination
}

function deepmerge(target, source, options) {
	options = options || {};
	options.arrayMerge = options.arrayMerge || defaultArrayMerge;
	options.isMergeableObject = options.isMergeableObject || isMergeableObject;
	// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()
	// implementations can use it. The caller may not replace it.
	options.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;

	var sourceIsArray = Array.isArray(source);
	var targetIsArray = Array.isArray(target);
	var sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;

	if (!sourceAndTargetTypesMatch) {
		return cloneUnlessOtherwiseSpecified(source, options)
	} else if (sourceIsArray) {
		return options.arrayMerge(target, source, options)
	} else {
		return mergeObject(target, source, options)
	}
}

deepmerge.all = function deepmergeAll(array, options) {
	if (!Array.isArray(array)) {
		throw new Error('first argument should be an array')
	}

	return array.reduce(function(prev, next) {
		return deepmerge(prev, next, options)
	}, {})
};

var deepmerge_1 = deepmerge;

var cjs = deepmerge_1;

var FlasherFactory = (function () {
    function FlasherFactory(viewFactory) {
        this.options = {
            timeout: 5000,
            fps: 30,
            position: 'top-right',
            direction: 'top',
            style: {}
        };
        this.viewFactory = viewFactory;
    }
    FlasherFactory.prototype.success = function (message, title, options) {
        this.flash('success', message, title, options);
    };
    FlasherFactory.prototype.info = function (message, title, options) {
        this.flash('info', message, title, options);
    };
    FlasherFactory.prototype.warning = function (message, title, options) {
        this.flash('warning', message, title, options);
    };
    FlasherFactory.prototype.error = function (message, title, options) {
        this.flash('error', message, title, options);
    };
    FlasherFactory.prototype.flash = function (type, message, title, options) {
        var notification = this.createNotification(type, message, title, options);
        this.renderOptions({});
        this.render({ notification: notification });
    };
    FlasherFactory.prototype.createNotification = function (type, message, title, options) {
        if (typeof type === 'object') {
            options = type;
            type = options.type;
            message = options.message;
            title = options.title;
        }
        else if (typeof message === 'object') {
            options = message;
            message = options.message;
            title = options.title;
        }
        else if (typeof title === 'object') {
            options = title;
            title = options.title;
        }
        if (undefined === message) {
            throw new Error('message option is required');
        }
        return {
            type: type || 'info',
            message: message,
            title: title,
            options: options
        };
    };
    FlasherFactory.prototype.render = function (envelope) {
        var _this = this;
        var notification = envelope.notification;
        var nOptions = notification.options || {};
        var options = Array.isArray(nOptions) ? this.options : cjs(this.options, nOptions);
        var onContainerReady = function () {
            var container = _this.createContainer(options);
            _this.addToContainer(container, envelope, options);
        };
        if ('loading' !== document.readyState) {
            onContainerReady();
        }
        document.addEventListener('DOMContentLoaded', onContainerReady);
    };
    FlasherFactory.prototype.renderOptions = function (options) {
        this.options = cjs(this.options, options);
    };
    FlasherFactory.prototype.createContainer = function (options) {
        var containerSelector = ".fl-main-container[data-position=\"".concat(options.position, "\"]");
        var container = document.querySelector(containerSelector);
        if (container) {
            return container;
        }
        container = document.createElement('div');
        container.classList.add('fl-main-container');
        container.dataset.position = options.position;
        Object.keys(options.style).forEach(function (key) {
            container === null || container === void 0 ? void 0 : container.style.setProperty(key, options.style[key]);
        });
        document.body.append(container);
        return container;
    };
    FlasherFactory.prototype.addToContainer = function (container, envelope, options) {
        var template = this.stringToHTML(envelope.template || this.viewFactory.render(envelope));
        this.appendNotification(container, template, options.direction);
        this.renderProgressBar(template, options);
        this.handleClick(template);
    };
    FlasherFactory.prototype.appendNotification = function (container, template, direction) {
        if (direction === 'bottom') {
            container.append(template);
        }
        else {
            container.prepend(template);
        }
        setTimeout(function () {
            template.classList.add('fl-show');
        }, 100);
    };
    FlasherFactory.prototype.removeNotification = function (template) {
        var container = template.parentElement;
        template.classList.remove('fl-show');
        template.addEventListener('transitionend', function () {
            template.remove();
            if (container.hasChildNodes()) {
                return;
            }
            container.remove();
        });
    };
    FlasherFactory.prototype.handleClick = function (template) {
        var _this = this;
        template.addEventListener('click', function () { return _this.removeNotification(template); });
    };
    FlasherFactory.prototype.renderProgressBar = function (template, options) {
        var _this = this;
        if (!options.timeout || options.timeout <= 0) {
            return;
        }
        var progressBar = document.createElement('span');
        progressBar.classList.add('fl-progress');
        var progressBarContainer = template.querySelector('.fl-progress-bar');
        progressBarContainer && progressBarContainer.append(progressBar);
        var lapse = 1000 / options.fps;
        var width = 0;
        var showProgress = function () {
            width += 1;
            var percent = (1 - lapse * (width / options.timeout)) * 100;
            progressBar.style.width = "".concat(percent, "%");
            if (percent <= 0) {
                clearInterval(progressInterval);
                _this.removeNotification(template);
            }
        };
        var progressInterval = window.setInterval(showProgress, lapse);
        template.addEventListener('mouseout', function () { return progressInterval = window.setInterval(showProgress, lapse); });
        template.addEventListener('mouseover', function () { return clearInterval(progressInterval); });
    };
    FlasherFactory.prototype.stringToHTML = function (str) {
        var support = (function () {
            if (!DOMParser) {
                return false;
            }
            var parser = new DOMParser();
            try {
                parser.parseFromString('x', 'text/html');
            }
            catch (err) {
                return false;
            }
            return true;
        })();
        if (support) {
            var parser = new DOMParser();
            var doc = parser.parseFromString(str, 'text/html');
            return doc.body.firstChild;
        }
        var dom = document.createElement('div');
        dom.innerHTML = str;
        return dom.firstElementChild;
    };
    return FlasherFactory;
}());

var Flasher = (function () {
    function Flasher() {
        this.defaultHandler = 'theme.flasher';
        this.factories = new Map();
        this.themes = new Map();
    }
    Flasher.prototype.success = function (message, title, options) {
        this.flash('success', message, title, options);
    };
    Flasher.prototype.info = function (message, title, options) {
        this.flash('info', message, title, options);
    };
    Flasher.prototype.warning = function (message, title, options) {
        this.flash('warning', message, title, options);
    };
    Flasher.prototype.error = function (message, title, options) {
        this.flash('error', message, title, options);
    };
    Flasher.prototype.flash = function (type, message, title, options) {
        var notification = this.createNotification(type, message, title, options);
        var factory = this.create(this.defaultHandler);
        factory.renderOptions({});
        factory.render({ notification: notification });
    };
    Flasher.prototype.createNotification = function (type, message, title, options) {
        if (typeof type === 'object') {
            options = type;
            type = options.type;
            message = options.message;
            title = options.title;
        }
        else if (typeof message === 'object') {
            options = message;
            message = options.message;
            title = options.title;
        }
        else if (typeof title === 'object') {
            options = title;
            title = options.title;
        }
        if (undefined === message) {
            throw new Error('message option is required');
        }
        return {
            type: type || 'info',
            message: message,
            title: title,
            options: options
        };
    };
    Flasher.prototype.create = function (alias) {
        alias = this.resolveHandler(alias);
        this.resolveThemeHandler(alias);
        var factory = this.factories.get(alias);
        if (!factory) {
            throw new Error("Unable to resolve \"".concat(alias, "\" notification factory, did you forget to register it?"));
        }
        return factory;
    };
    Flasher.prototype.renderOptions = function (options) {
        var _this = this;
        Object.entries(options).forEach(function (_a) {
            var handler = _a[0], option = _a[1];
            _this.create(handler).renderOptions(option);
        });
    };
    Flasher.prototype.render = function (response) {
        var _this = this;
        response = this.resolveResponse(response);
        this.addStyles(response.styles, function () {
            _this.addScripts(response.scripts, function () {
                _this.renderOptions(response.options);
                _this.renderEnvelopes(response.envelopes, response.context);
            });
        });
    };
    Flasher.prototype.addFactory = function (name, factory) {
        this.factories.set(name, factory);
    };
    Flasher.prototype.addTheme = function (name, theme) {
        this.themes.set(name, theme);
    };
    Flasher.prototype.using = function (name) {
        this.defaultHandler = name;
        return this;
    };
    Flasher.prototype.addStyles = function (urls, callback) {
        var _this = this;
        if (urls.length === 0) {
            if (typeof callback === 'function') {
                callback();
            }
            return;
        }
        if (document.querySelector("link[href=\"".concat(urls[0], "\"]")) !== null) {
            this.addStyles(urls.slice(1), callback);
            return;
        }
        var tag = document.createElement('link');
        tag.setAttribute('href', urls[0]);
        tag.setAttribute('type', 'text/css');
        tag.setAttribute('rel', 'stylesheet');
        tag.onload = function () { return _this.addStyles(urls.slice(1), callback); };
        document.head.appendChild(tag);
    };
    Flasher.prototype.addScripts = function (urls, callback) {
        var _this = this;
        if (urls.length === 0) {
            if (typeof callback === 'function') {
                callback();
            }
            return;
        }
        if (document.querySelector("script[src=\"".concat(urls[0], "\"]")) !== null) {
            this.addScripts(urls.slice(1), callback);
            return;
        }
        var tag = document.createElement('script');
        tag.setAttribute('src', urls[0]);
        tag.setAttribute('type', 'text/javascript');
        tag.onload = function () { return _this.addScripts(urls.slice(1), callback); };
        document.body.appendChild(tag);
    };
    Flasher.prototype.renderEnvelopes = function (envelopes, context) {
        var _this = this;
        var queues = new Map();
        envelopes.forEach(function (envelope) {
            envelope.context = Object.assign({}, envelope.context || {}, context);
            envelope.handler = _this.resolveHandler(envelope.handler);
            var factory = _this.create(envelope.handler);
            if (!_this.isQueueable(factory)) {
                factory.render(envelope);
                return;
            }
            queues.get(envelope.handler) || factory.resetQueue();
            factory.addEnvelope(envelope);
            queues.set(envelope.handler, factory);
        });
        queues.forEach(function (factory) { return factory.renderQueue(); });
    };
    Flasher.prototype.isQueueable = function (object) {
        return typeof object.addEnvelope === 'function'
            && typeof object.renderQueue === 'function';
    };
    Flasher.prototype.resolveResponse = function (response) {
        var _this = this;
        response.envelopes = response.envelopes || [];
        response.options = response.options || {};
        response.scripts = response.scripts || [];
        response.styles = response.styles || [];
        response.context = response.context || {};
        Object.entries(response.options).forEach(function (_a) {
            var handler = _a[0], options = _a[1];
            response.options[handler] = _this.parseOptions(options);
        });
        response.envelopes.forEach(function (envelope) {
            envelope.handler = _this.resolveHandler(envelope.handler);
            envelope.notification.options = _this.parseOptions(envelope.notification.options || {});
            _this.pushStyles(response, envelope.handler);
        });
        return response;
    };
    Flasher.prototype.parseOptions = function (options) {
        var _this = this;
        Object.entries(options).forEach(function (_a) {
            var key = _a[0], value = _a[1];
            options[key] = _this.parseFunction(value);
        });
        return options;
    };
    Flasher.prototype.parseFunction = function (func) {
        var _a, _b;
        if (typeof func !== 'string') {
            return func;
        }
        var match = func.match(/^function(?:.+)?(?:\s+)?\((.+)?\)(?:\s+|\n+)?{(?:\s+|\n+)?((?:.|\n)+)}$/m);
        if (!match) {
            return func;
        }
        var args = (_b = (_a = match[1]) === null || _a === void 0 ? void 0 : _a.split(',').map(function (arg) { return arg.trim(); })) !== null && _b !== void 0 ? _b : [];
        var body = match[2];
        return new (Function.bind.apply(Function, __spreadArray(__spreadArray([void 0], args, false), [body], false)))();
    };
    Flasher.prototype.pushStyles = function (response, handler) {
        var _a;
        handler = handler.replace('theme.', '');
        var styles = ((_a = this.themes.get(handler)) === null || _a === void 0 ? void 0 : _a.styles) || [];
        response.styles = response.styles
            .concat(styles)
            .filter(function (value, index, self) { return self.indexOf(value) === index; });
    };
    Flasher.prototype.resolveHandler = function (handler) {
        handler = handler || this.defaultHandler;
        if (['flasher', 'theme', 'template'].includes(handler)) {
            handler = 'theme.flasher';
        }
        handler = handler.replace('template.', 'theme.');
        return handler;
    };
    Flasher.prototype.resolveThemeHandler = function (alias) {
        if (0 !== alias.indexOf('theme.')) {
            return;
        }
        var viewFactory = this.themes.get(alias.replace('theme.', ''));
        if (!viewFactory) {
            return;
        }
        this.addFactory(alias, new FlasherFactory(viewFactory));
    };
    return Flasher;
}());

var flasher = new Flasher();
flasher.addTheme('flasher', {
    render: function (envelope) {
        var _a;
        var notification = envelope.notification;
        return '<div class="fl-flasher fl-container fl-' + notification.type + '">' +
            '<div class="fl-content">' +
            '<div class="fl-icon"></div>' +
            '<div>' +
            '<strong class="fl-title">' + ((_a = notification.title) !== null && _a !== void 0 ? _a : notification.type) + '</strong>' +
            '<span class="fl-message">' + notification.message + '</span>' +
            '</div>' +
            '</div>' +
            '<span class="fl-progress-bar"></span>' +
            '</div>';
    }
});

module.exports = flasher;


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfcG5wbV9mbGFzaGVyX2ZsYXNoZXJfMV8wXzExX25vZGVfbW9kdWxlc19mbGFzaGVyX2ZsYXNoZXJfZGlzdF9pbmRleF9qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBYTs7QUFFYixjQUFjLGdCQUFnQixvQ0FBb0MseUtBQXlLLE1BQU0sbUJBQW1CLDhCQUE4Qix1Q0FBdUMsV0FBVyw0SEFBNEgsYUFBYSxzQ0FBc0MsMEZBQTBGLFdBQVcsNENBQTRDLDZDQUE2Qzs7QUFFanNCLDhCQUE4QixtQkFBbUIsZ0JBQWdCLGtCQUFrQixvQ0FBb0MsZ0RBQWdELG1CQUFtQixtREFBbUQsc0JBQXNCLGtEQUFrRCxxQkFBcUIsa0VBQWtFLHFDQUFxQyxpREFBaUQsb0JBQW9CLGlFQUFpRSxzQ0FBc0MsbURBQW1ELGVBQWUsbUNBQW1DLG1FQUFtRSxxQ0FBcUMsc0VBQXNFLG9DQUFvQyxxQ0FBcUMsNENBQTRDLDZDQUE2QyxrQ0FBa0MsZ0RBQWdELHlDQUF5Qyx5REFBeUQsbUNBQW1DLDBEQUEwRCx3QkFBd0IsaUVBQWlFLGlDQUFpQyxnRkFBZ0YscUNBQXFDLDZDQUE2Qyx5Q0FBeUMsc0RBQXNELG1DQUFtQyx1REFBdUQsd0JBQXdCLDhEQUE4RCxpQ0FBaUMsNkVBQTZFLHFDQUFxQyxnREFBZ0QseUNBQXlDLHlEQUF5RCxtQ0FBbUMsMERBQTBELHdCQUF3QixpRUFBaUUsaUNBQWlDLGdGQUFnRixxQ0FBcUMsOENBQThDLHlDQUF5Qyx1REFBdUQsbUNBQW1DLHdEQUF3RCx3QkFBd0IsK0RBQStELGlDQUFpQyw4RUFBOEUscUNBQXFDLDhDQUE4QyxzQkFBc0IsY0FBYyxlQUFlLGFBQWEsc0JBQXNCLHNCQUFzQiwwQkFBMEIseUJBQXlCLGtCQUFrQixzR0FBc0csbUJBQW1CLHdCQUF3Qix3QkFBd0IscUJBQXFCLDhCQUE4Qiw0SEFBNEgsaUJBQWlCLGlCQUFpQixrQ0FBa0Msd0JBQXdCLGNBQWMsZ0JBQWdCLDhCQUE4QixxQ0FBcUMsK0RBQStELGdCQUFnQixvQkFBb0Isc0hBQXNILGlCQUFpQixrQ0FBa0MsYUFBYSwrQkFBK0IsMkJBQTJCLDZEQUE2RCxrQkFBa0IsZ0JBQWdCLDREQUE0RCxrQkFBa0IsNkRBQTZELGlCQUFpQiw0SEFBNEgsaUJBQWlCLGtDQUFrQyx5QkFBeUIsYUFBYSxpQ0FBaUMsZ0VBQWdFLGtCQUFrQixpQkFBaUIsK0RBQStELGtCQUFrQixpQkFBaUIsd0hBQXdILGlCQUFpQixpQkFBaUIsa0NBQWtDLHdCQUF3QixvREFBb0QsWUFBWSxlQUFlLDZEQUE2RCxxREFBcUQsOENBQThDLHNLQUFzSyxvQkFBb0IsMkJBQTJCLGtCQUFrQixzQkFBc0Isd0NBQXdDLG1CQUFtQix1RkFBdUYsNEJBQTRCLDREQUE0RCxtQkFBbUIsc0JBQXNCLDJCQUEyQix5REFBeUQseUJBQXlCLG1IQUFtSCxvQkFBb0IsdUJBQXVCLDBCQUEwQixrQ0FBa0MsMERBQTBELHFCQUFxQix3QkFBd0IsNERBQTRELHlCQUF5QiwyQkFBMkIsaUVBQWlFLG1CQUFtQixzQkFBc0IseUJBQXlCLHNEQUFzRCw2QkFBNkIsa0JBQWtCLHdDQUF3QyxnREFBZ0QsK0JBQStCLHNCQUFzQjtBQUN0L00sUUFBUTs7QUFFUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZFQUE2RSxPQUFPO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUUsSUFBSTtBQUNOOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCLHNCQUFzQiw0QkFBNEI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLHlEQUF5RCw0Q0FBNEM7QUFDckc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsb0VBQW9FO0FBQ2hJLDZEQUE2RCx5Q0FBeUM7QUFDdEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDLHlCQUF5Qiw0QkFBNEI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0Msd0JBQXdCO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCw0Q0FBNEMsK0JBQStCO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0Esa0dBQWtHO0FBQ2xHO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFLHdCQUF3QjtBQUN0RztBQUNBO0FBQ0E7QUFDQSxpSEFBaUgsb0JBQW9CO0FBQ3JJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9EQUFvRCx1Q0FBdUM7QUFDM0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmbGFzaGVyK2ZsYXNoZXJAMS4wLjExL25vZGVfbW9kdWxlcy9AZmxhc2hlci9mbGFzaGVyL2Rpc3QvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZT1bXSx0PVtdO2Z1bmN0aW9uIG4obixyKXtpZihuJiZcInVuZGVmaW5lZFwiIT10eXBlb2YgZG9jdW1lbnQpe3ZhciBhLHM9ITA9PT1yLnByZXBlbmQ/XCJwcmVwZW5kXCI6XCJhcHBlbmRcIixkPSEwPT09ci5zaW5nbGVUYWcsaT1cInN0cmluZ1wiPT10eXBlb2Ygci5jb250YWluZXI/ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihyLmNvbnRhaW5lcik6ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdO2lmKGQpe3ZhciB1PWUuaW5kZXhPZihpKTstMT09PXUmJih1PWUucHVzaChpKS0xLHRbdV09e30pLGE9dFt1XSYmdFt1XVtzXT90W3VdW3NdOnRbdV1bc109YygpO31lbHNlIGE9YygpOzY1Mjc5PT09bi5jaGFyQ29kZUF0KDApJiYobj1uLnN1YnN0cmluZygxKSksYS5zdHlsZVNoZWV0P2Euc3R5bGVTaGVldC5jc3NUZXh0Kz1uOmEuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobikpO31mdW5jdGlvbiBjKCl7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInN0eWxlXCIpO2lmKGUuc2V0QXR0cmlidXRlKFwidHlwZVwiLFwidGV4dC9jc3NcIiksci5hdHRyaWJ1dGVzKWZvcih2YXIgdD1PYmplY3Qua2V5cyhyLmF0dHJpYnV0ZXMpLG49MDtuPHQubGVuZ3RoO24rKyllLnNldEF0dHJpYnV0ZSh0W25dLHIuYXR0cmlidXRlc1t0W25dXSk7dmFyIGE9XCJwcmVwZW5kXCI9PT1zP1wiYWZ0ZXJiZWdpblwiOlwiYmVmb3JlZW5kXCI7cmV0dXJuIGkuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KGEsZSksZX19XG5cbnZhciBjc3MgPSBcIi5mbC1tYWluLWNvbnRhaW5lcntcXG4gIHBvc2l0aW9uOmZpeGVkO1xcbiAgd2lkdGg6MjRyZW07XFxuICB6LWluZGV4Ojk5OTk5O1xcbiAgdHJhbnNpdGlvbjphbGwgMXMgZWFzZS1pbi1vdXQ7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lcltkYXRhLXBvc2l0aW9uXj1cXFwidG9wLVxcXCJde1xcbiAgICB0b3A6MC41cmVtOyB9XFxuICAuZmwtbWFpbi1jb250YWluZXJbZGF0YS1wb3NpdGlvbl49XFxcImJvdHRvbS1cXFwiXXtcXG4gICAgYm90dG9tOjAuNXJlbTsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyW2RhdGEtcG9zaXRpb24kPVxcXCItcmlnaHRcXFwiXXtcXG4gICAgcmlnaHQ6MC41cmVtOyB9XFxuICAgIC5mbC1tYWluLWNvbnRhaW5lcltkYXRhLXBvc2l0aW9uJD1cXFwiLXJpZ2h0XFxcIl0gLmZsLWNvbnRhaW5lcntcXG4gICAgICB0cmFuc2Zvcm06dHJhbnNsYXRlWCgxMTAlKTsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyW2RhdGEtcG9zaXRpb24kPVxcXCItbGVmdFxcXCJde1xcbiAgICBsZWZ0OjAuNXJlbTsgfVxcbiAgICAuZmwtbWFpbi1jb250YWluZXJbZGF0YS1wb3NpdGlvbiQ9XFxcIi1sZWZ0XFxcIl0gLmZsLWNvbnRhaW5lcntcXG4gICAgICB0cmFuc2Zvcm06dHJhbnNsYXRlWCgtMTEwJSk7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lcltkYXRhLXBvc2l0aW9uJD1cXFwiLWNlbnRlclxcXCJde1xcbiAgICBsZWZ0OjUwJTtcXG4gICAgdHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lcltkYXRhLXBvc2l0aW9uPVxcXCJ0b3AtY2VudGVyXFxcIl0gLmZsLWNvbnRhaW5lcntcXG4gICAgdHJhbnNmb3JtOnRyYW5zbGF0ZVkoLTEwMHZoKTsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyW2RhdGEtcG9zaXRpb249XFxcImJvdHRvbS1jZW50ZXJcXFwiXSAuZmwtY29udGFpbmVye1xcbiAgICB0cmFuc2Zvcm06dHJhbnNsYXRlWSgxMDB2aCk7IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lcntcXG4gIHRyYW5zaXRpb246dHJhbnNmb3JtIDAuM3MgZWFzZS1pbi1vdXQ7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXNob3d7XFxuICAgIHRyYW5zZm9ybTp0cmFuc2xhdGUoMCwgMCk7IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1zdWNjZXNze1xcbiAgYm9yZGVyLWxlZnQ6MC44cmVtIHNvbGlkICMwNTk2NjlGRjsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtc3VjY2VzcyAuZmwtaWNvbntcXG4gICAgYmFja2dyb3VuZC1jb2xvcjojMDU5NjY5RkY7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXN1Y2Nlc3MgLmZsLXRpdGxle1xcbiAgICBjb2xvcjojMDU5NjY5RkY7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXN1Y2Nlc3MgLmZsLXByb2dyZXNzLWJhcntcXG4gICAgYmFja2dyb3VuZC1jb2xvcjojNmRmYWNlOyB9XFxuICAgIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXN1Y2Nlc3MgLmZsLXByb2dyZXNzLWJhciAuZmwtcHJvZ3Jlc3N7XFxuICAgICAgYmFja2dyb3VuZC1jb2xvcjojMDU5NjY5RkY7IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1pbmZve1xcbiAgYm9yZGVyLWxlZnQ6MC44cmVtIHNvbGlkICMyNTYzRUJGRjsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtaW5mbyAuZmwtaWNvbntcXG4gICAgYmFja2dyb3VuZC1jb2xvcjojMjU2M0VCRkY7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWluZm8gLmZsLXRpdGxle1xcbiAgICBjb2xvcjojMjU2M0VCRkY7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWluZm8gLmZsLXByb2dyZXNzLWJhcntcXG4gICAgYmFja2dyb3VuZC1jb2xvcjojZTBlOWZjOyB9XFxuICAgIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWluZm8gLmZsLXByb2dyZXNzLWJhciAuZmwtcHJvZ3Jlc3N7XFxuICAgICAgYmFja2dyb3VuZC1jb2xvcjojMjU2M0VCRkY7IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC13YXJuaW5ne1xcbiAgYm9yZGVyLWxlZnQ6MC44cmVtIHNvbGlkICNEOTc3MDZGRjsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtd2FybmluZyAuZmwtaWNvbntcXG4gICAgYmFja2dyb3VuZC1jb2xvcjojRDk3NzA2RkY7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXdhcm5pbmcgLmZsLXRpdGxle1xcbiAgICBjb2xvcjojRDk3NzA2RkY7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXdhcm5pbmcgLmZsLXByb2dyZXNzLWJhcntcXG4gICAgYmFja2dyb3VuZC1jb2xvcjojZmRkOGFlOyB9XFxuICAgIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXdhcm5pbmcgLmZsLXByb2dyZXNzLWJhciAuZmwtcHJvZ3Jlc3N7XFxuICAgICAgYmFja2dyb3VuZC1jb2xvcjojRDk3NzA2RkY7IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1lcnJvcntcXG4gIGJvcmRlci1sZWZ0OjAuOHJlbSBzb2xpZCAjREMyNjI2RkY7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWVycm9yIC5mbC1pY29ue1xcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiNEQzI2MjZGRjsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtZXJyb3IgLmZsLXRpdGxle1xcbiAgICBjb2xvcjojREMyNjI2RkY7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWVycm9yIC5mbC1wcm9ncmVzcy1iYXJ7XFxuICAgIGJhY2tncm91bmQtY29sb3I6I2Y4ZDZkNjsgfVxcbiAgICAuZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1lcnJvciAuZmwtcHJvZ3Jlc3MtYmFyIC5mbC1wcm9ncmVzc3tcXG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiNEQzI2MjZGRjsgfVxcblxcbi5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyIC5mbC1pY29ue1xcbiAgcG9zaXRpb246cmVsYXRpdmU7XFxuICB3aWR0aDoxZW07XFxuICBoZWlnaHQ6MWVtO1xcbiAgbWFyZ2luOjA7XFxuICBib3JkZXItcmFkaXVzOjUwJTtcXG4gIHRyYW5zaXRpb246YWxsIDFzO1xcbiAgYm94LXNpemluZzpib3JkZXItYm94O1xcbiAgZGlzcGxheTppbmxpbmUtYmxvY2s7XFxuICBjb2xvcjp3aGl0ZTsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIgLmZsLWljb246YmVmb3JlLCAuZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lciAuZmwtaWNvbjphZnRlcntcXG4gICAgY29udGVudDpcXFwiXFxcIjtcXG4gICAgcG9zaXRpb246YWJzb2x1dGU7XFxuICAgIHRyYW5zaXRpb246YWxsIDFzO1xcbiAgICBib3JkZXItd2lkdGg6MDtcXG4gICAgYm94LXNpemluZzpib3JkZXItYm94OyB9XFxuXFxuLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtc3VjY2VzcyAuZmwtaWNvbjpiZWZvcmUsIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXN1Y2Nlc3MgLmZsLWljb246YWZ0ZXJ7XFxuICB3aWR0aDowLjE2ZW07XFxuICBoZWlnaHQ6MC42ZW07XFxuICBiYWNrZ3JvdW5kLWNvbG9yOmN1cnJlbnRDb2xvcjtcXG4gIGJvcmRlci1yYWRpdXM6MC4xZW07XFxuICB0b3A6MC42ZW07XFxuICBsZWZ0OjAuMzVlbTtcXG4gIHRyYW5zZm9ybTpyb3RhdGUoLTEzNWRlZyk7XFxuICB0cmFuc2Zvcm0tb3JpZ2luOjAuMDhlbSAwLjA4ZW07IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1zdWNjZXNzIC5mbC1pY29uOmFmdGVye1xcbiAgd2lkdGg6MC40ZW07XFxuICBoZWlnaHQ6MC4xNmVtOyB9XFxuXFxuLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtaW5mbyAuZmwtaWNvbjpiZWZvcmUsIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWluZm8gLmZsLWljb246YWZ0ZXJ7XFxuICB3aWR0aDowLjE1ZW07XFxuICBiYWNrZ3JvdW5kLWNvbG9yOmN1cnJlbnRDb2xvcjtcXG4gIGxlZnQ6NTAlO1xcbiAgdHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7XFxuICBib3JkZXItcmFkaXVzOjAuMDNlbTsgfVxcblxcbi5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWluZm8gLmZsLWljb246YmVmb3Jle1xcbiAgaGVpZ2h0OjAuMzhlbTtcXG4gIHRvcDowLjRlbTsgfVxcblxcbi5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWluZm8gLmZsLWljb246YWZ0ZXJ7XFxuICBoZWlnaHQ6MC4xM2VtO1xcbiAgYm94LXNoYWRvdzotMC4wNmVtIDAuMTllbSwgLTAuMDZlbSAwLjQ0ZW0sIDAuMDZlbSAwLjQ0ZW07XFxuICB0b3A6MC4yMWVtOyB9XFxuXFxuLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtd2FybmluZyAuZmwtaWNvbjpiZWZvcmUsIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXdhcm5pbmcgLmZsLWljb246YWZ0ZXJ7XFxuICB3aWR0aDowLjE1ZW07XFxuICBiYWNrZ3JvdW5kLWNvbG9yOmN1cnJlbnRDb2xvcjtcXG4gIGJvcmRlci1yYWRpdXM6MC4wM2VtO1xcbiAgbGVmdDo1MCU7XFxuICB0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsgfVxcblxcbi5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLXdhcm5pbmcgLmZsLWljb246YmVmb3Jle1xcbiAgaGVpZ2h0OjAuMzhlbTtcXG4gIHRvcDowLjIxZW07IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC13YXJuaW5nIC5mbC1pY29uOmFmdGVye1xcbiAgaGVpZ2h0OjAuMTNlbTtcXG4gIHRvcDowLjY1ZW07IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1lcnJvciAuZmwtaWNvbjpiZWZvcmUsIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWVycm9yIC5mbC1pY29uOmFmdGVye1xcbiAgd2lkdGg6MC4xNmVtO1xcbiAgaGVpZ2h0OjAuN2VtO1xcbiAgYmFja2dyb3VuZC1jb2xvcjpjdXJyZW50Q29sb3I7XFxuICBib3JkZXItcmFkaXVzOjAuMWVtO1xcbiAgdHJhbnNmb3JtOnRyYW5zbGF0ZSgtNTAlLCAtNTAlKSByb3RhdGUoLTEzNWRlZyk7XFxuICB0b3A6NTAlO1xcbiAgbGVmdDo1MCU7IH1cXG5cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1lcnJvciAuZmwtaWNvbjphZnRlcntcXG4gIHRyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwgLTUwJSkgcm90YXRlKC00NWRlZyk7IH1cXG4uZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1mbGFzaGVye1xcbiAgZm9udC1mYW1pbHk6LWFwcGxlLXN5c3RlbSwgQmxpbmtNYWNTeXN0ZW1Gb250LCBcXFwiU2Vnb2UgVUlcXFwiLCBSb2JvdG8sIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWYsIFxcXCJBcHBsZSBDb2xvciBFbW9qaVxcXCIsIFxcXCJTZWdvZSBVSSBFbW9qaVxcXCIsIFxcXCJTZWdvZSBVSSBTeW1ib2xcXFwiO1xcbiAgbGluZS1oZWlnaHQ6MS41O1xcbiAgYmFja2dyb3VuZC1jb2xvcjp3aGl0ZTtcXG4gIGNvbG9yOiM0YjU1NjM7XFxuICBtYXJnaW4tdG9wOjAuNXJlbTtcXG4gIGJvcmRlci1yYWRpdXM6MC4zNzVyZW0gMCAwIDAuMzc1cmVtO1xcbiAgY3Vyc29yOnBvaW50ZXI7XFxuICBib3gtc2hhZG93OjAgMTBweCAxNXB4IC0zcHggcmdiYSgwLCAwLCAwLCAwLjEpLCAwIDRweCA2cHggLTJweCByZ2JhKDAsIDAsIDAsIDAuMDUpO1xcbiAgd29yZC1icmVhazpicmVhay13b3JkOyB9XFxuICAuZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1mbGFzaGVyIC5mbC1jb250ZW50e1xcbiAgICBkaXNwbGF5OmZsZXg7XFxuICAgIHBhZGRpbmc6MC43NXJlbTtcXG4gICAgYWxpZ24taXRlbXM6Y2VudGVyOyB9XFxuICAuZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1mbGFzaGVyIC5mbC1pY29ue1xcbiAgICBmb250LXNpemU6Mi41cmVtOyB9XFxuICAuZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1mbGFzaGVyIC5mbC10aXRsZSwgLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtZmxhc2hlciAuZmwtbWVzc2FnZXtcXG4gICAgZGlzcGxheTpibG9jaztcXG4gICAgbWFyZ2luLWxlZnQ6MXJlbTtcXG4gICAgbGluZS1oZWlnaHQ6MS4yNXJlbTtcXG4gICAgdGV4dC10cmFuc2Zvcm06Y2FwaXRhbGl6ZTsgfVxcbiAgLmZsLW1haW4tY29udGFpbmVyIC5mbC1jb250YWluZXIuZmwtZmxhc2hlciAuZmwtdGl0bGV7XFxuICAgIGZvbnQtc2l6ZToxcmVtO1xcbiAgICBmb250LXdlaWdodDo1MDA7IH1cXG4gIC5mbC1tYWluLWNvbnRhaW5lciAuZmwtY29udGFpbmVyLmZsLWZsYXNoZXIgLmZsLW1lc3NhZ2V7XFxuICAgIG1hcmdpbi10b3A6MC4yNXJlbTtcXG4gICAgZm9udC1zaXplOjAuODc1cmVtOyB9XFxuICAuZmwtbWFpbi1jb250YWluZXIgLmZsLWNvbnRhaW5lci5mbC1mbGFzaGVyIC5mbC1wcm9ncmVzcy1iYXJ7XFxuICAgIGRpc3BsYXk6ZmxleDtcXG4gICAgaGVpZ2h0OjAuMTI1cmVtO1xcbiAgICBtYXJnaW4tbGVmdDotMXB4OyB9XFxuXFxuLmRhcmsgLmZsLW1haW4tY29udGFpbmVyIC5mbC1mbGFzaGVyLmZsLWNvbnRhaW5lcntcXG4gIGJhY2tncm91bmQtY29sb3I6IzBmMTcyYTtcXG4gIGNvbG9yOndoaXRlOyB9XFxuXFxuQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyayl7XFxuICAuZmwtbWFpbi1jb250YWluZXIgLmZsLWZsYXNoZXIuZmwtY29udGFpbmVye1xcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiMwZjE3MmE7XFxuICAgIGNvbG9yOndoaXRlOyB9IH1cXG5cIjtcbm4oY3NzLHt9KTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcblxyXG5mdW5jdGlvbiBfX3NwcmVhZEFycmF5KHRvLCBmcm9tLCBwYWNrKSB7XHJcbiAgICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgIGlmIChhciB8fCAhKGkgaW4gZnJvbSkpIHtcclxuICAgICAgICAgICAgaWYgKCFhcikgYXIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tLCAwLCBpKTtcclxuICAgICAgICAgICAgYXJbaV0gPSBmcm9tW2ldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpO1xyXG59XG5cbnZhciBpc01lcmdlYWJsZU9iamVjdCA9IGZ1bmN0aW9uIGlzTWVyZ2VhYmxlT2JqZWN0KHZhbHVlKSB7XG5cdHJldHVybiBpc05vbk51bGxPYmplY3QodmFsdWUpXG5cdFx0JiYgIWlzU3BlY2lhbCh2YWx1ZSlcbn07XG5cbmZ1bmN0aW9uIGlzTm9uTnVsbE9iamVjdCh2YWx1ZSkge1xuXHRyZXR1cm4gISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnXG59XG5cbmZ1bmN0aW9uIGlzU3BlY2lhbCh2YWx1ZSkge1xuXHR2YXIgc3RyaW5nVmFsdWUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpO1xuXG5cdHJldHVybiBzdHJpbmdWYWx1ZSA9PT0gJ1tvYmplY3QgUmVnRXhwXSdcblx0XHR8fCBzdHJpbmdWYWx1ZSA9PT0gJ1tvYmplY3QgRGF0ZV0nXG5cdFx0fHwgaXNSZWFjdEVsZW1lbnQodmFsdWUpXG59XG5cbi8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QvYmxvYi9iNWFjOTYzZmI3OTFkMTI5OGU3ZjM5NjIzNjM4M2JjOTU1ZjkxNmMxL3NyYy9pc29tb3JwaGljL2NsYXNzaWMvZWxlbWVudC9SZWFjdEVsZW1lbnQuanMjTDIxLUwyNVxudmFyIGNhblVzZVN5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgU3ltYm9sLmZvcjtcbnZhciBSRUFDVF9FTEVNRU5UX1RZUEUgPSBjYW5Vc2VTeW1ib2wgPyBTeW1ib2wuZm9yKCdyZWFjdC5lbGVtZW50JykgOiAweGVhYzc7XG5cbmZ1bmN0aW9uIGlzUmVhY3RFbGVtZW50KHZhbHVlKSB7XG5cdHJldHVybiB2YWx1ZS4kJHR5cGVvZiA9PT0gUkVBQ1RfRUxFTUVOVF9UWVBFXG59XG5cbmZ1bmN0aW9uIGVtcHR5VGFyZ2V0KHZhbCkge1xuXHRyZXR1cm4gQXJyYXkuaXNBcnJheSh2YWwpID8gW10gOiB7fVxufVxuXG5mdW5jdGlvbiBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZCh2YWx1ZSwgb3B0aW9ucykge1xuXHRyZXR1cm4gKG9wdGlvbnMuY2xvbmUgIT09IGZhbHNlICYmIG9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QodmFsdWUpKVxuXHRcdD8gZGVlcG1lcmdlKGVtcHR5VGFyZ2V0KHZhbHVlKSwgdmFsdWUsIG9wdGlvbnMpXG5cdFx0OiB2YWx1ZVxufVxuXG5mdW5jdGlvbiBkZWZhdWx0QXJyYXlNZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucykge1xuXHRyZXR1cm4gdGFyZ2V0LmNvbmNhdChzb3VyY2UpLm1hcChmdW5jdGlvbihlbGVtZW50KSB7XG5cdFx0cmV0dXJuIGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKGVsZW1lbnQsIG9wdGlvbnMpXG5cdH0pXG59XG5cbmZ1bmN0aW9uIGdldE1lcmdlRnVuY3Rpb24oa2V5LCBvcHRpb25zKSB7XG5cdGlmICghb3B0aW9ucy5jdXN0b21NZXJnZSkge1xuXHRcdHJldHVybiBkZWVwbWVyZ2Vcblx0fVxuXHR2YXIgY3VzdG9tTWVyZ2UgPSBvcHRpb25zLmN1c3RvbU1lcmdlKGtleSk7XG5cdHJldHVybiB0eXBlb2YgY3VzdG9tTWVyZ2UgPT09ICdmdW5jdGlvbicgPyBjdXN0b21NZXJnZSA6IGRlZXBtZXJnZVxufVxuXG5mdW5jdGlvbiBnZXRFbnVtZXJhYmxlT3duUHJvcGVydHlTeW1ib2xzKHRhcmdldCkge1xuXHRyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sc1xuXHRcdD8gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh0YXJnZXQpLmZpbHRlcihmdW5jdGlvbihzeW1ib2wpIHtcblx0XHRcdHJldHVybiB0YXJnZXQucHJvcGVydHlJc0VudW1lcmFibGUoc3ltYm9sKVxuXHRcdH0pXG5cdFx0OiBbXVxufVxuXG5mdW5jdGlvbiBnZXRLZXlzKHRhcmdldCkge1xuXHRyZXR1cm4gT2JqZWN0LmtleXModGFyZ2V0KS5jb25jYXQoZ2V0RW51bWVyYWJsZU93blByb3BlcnR5U3ltYm9scyh0YXJnZXQpKVxufVxuXG5mdW5jdGlvbiBwcm9wZXJ0eUlzT25PYmplY3Qob2JqZWN0LCBwcm9wZXJ0eSkge1xuXHR0cnkge1xuXHRcdHJldHVybiBwcm9wZXJ0eSBpbiBvYmplY3Rcblx0fSBjYXRjaChfKSB7XG5cdFx0cmV0dXJuIGZhbHNlXG5cdH1cbn1cblxuLy8gUHJvdGVjdHMgZnJvbSBwcm90b3R5cGUgcG9pc29uaW5nIGFuZCB1bmV4cGVjdGVkIG1lcmdpbmcgdXAgdGhlIHByb3RvdHlwZSBjaGFpbi5cbmZ1bmN0aW9uIHByb3BlcnR5SXNVbnNhZmUodGFyZ2V0LCBrZXkpIHtcblx0cmV0dXJuIHByb3BlcnR5SXNPbk9iamVjdCh0YXJnZXQsIGtleSkgLy8gUHJvcGVydGllcyBhcmUgc2FmZSB0byBtZXJnZSBpZiB0aGV5IGRvbid0IGV4aXN0IGluIHRoZSB0YXJnZXQgeWV0LFxuXHRcdCYmICEoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGFyZ2V0LCBrZXkpIC8vIHVuc2FmZSBpZiB0aGV5IGV4aXN0IHVwIHRoZSBwcm90b3R5cGUgY2hhaW4sXG5cdFx0XHQmJiBPYmplY3QucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh0YXJnZXQsIGtleSkpIC8vIGFuZCBhbHNvIHVuc2FmZSBpZiB0aGV5J3JlIG5vbmVudW1lcmFibGUuXG59XG5cbmZ1bmN0aW9uIG1lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlLCBvcHRpb25zKSB7XG5cdHZhciBkZXN0aW5hdGlvbiA9IHt9O1xuXHRpZiAob3B0aW9ucy5pc01lcmdlYWJsZU9iamVjdCh0YXJnZXQpKSB7XG5cdFx0Z2V0S2V5cyh0YXJnZXQpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRkZXN0aW5hdGlvbltrZXldID0gY2xvbmVVbmxlc3NPdGhlcndpc2VTcGVjaWZpZWQodGFyZ2V0W2tleV0sIG9wdGlvbnMpO1xuXHRcdH0pO1xuXHR9XG5cdGdldEtleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuXHRcdGlmIChwcm9wZXJ0eUlzVW5zYWZlKHRhcmdldCwga2V5KSkge1xuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXG5cdFx0aWYgKHByb3BlcnR5SXNPbk9iamVjdCh0YXJnZXQsIGtleSkgJiYgb3B0aW9ucy5pc01lcmdlYWJsZU9iamVjdChzb3VyY2Vba2V5XSkpIHtcblx0XHRcdGRlc3RpbmF0aW9uW2tleV0gPSBnZXRNZXJnZUZ1bmN0aW9uKGtleSwgb3B0aW9ucykodGFyZ2V0W2tleV0sIHNvdXJjZVtrZXldLCBvcHRpb25zKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0ZGVzdGluYXRpb25ba2V5XSA9IGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKHNvdXJjZVtrZXldLCBvcHRpb25zKTtcblx0XHR9XG5cdH0pO1xuXHRyZXR1cm4gZGVzdGluYXRpb25cbn1cblxuZnVuY3Rpb24gZGVlcG1lcmdlKHRhcmdldCwgc291cmNlLCBvcHRpb25zKSB7XG5cdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHRvcHRpb25zLmFycmF5TWVyZ2UgPSBvcHRpb25zLmFycmF5TWVyZ2UgfHwgZGVmYXVsdEFycmF5TWVyZ2U7XG5cdG9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QgPSBvcHRpb25zLmlzTWVyZ2VhYmxlT2JqZWN0IHx8IGlzTWVyZ2VhYmxlT2JqZWN0O1xuXHQvLyBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZCBpcyBhZGRlZCB0byBgb3B0aW9uc2Agc28gdGhhdCBjdXN0b20gYXJyYXlNZXJnZSgpXG5cdC8vIGltcGxlbWVudGF0aW9ucyBjYW4gdXNlIGl0LiBUaGUgY2FsbGVyIG1heSBub3QgcmVwbGFjZSBpdC5cblx0b3B0aW9ucy5jbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZCA9IGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkO1xuXG5cdHZhciBzb3VyY2VJc0FycmF5ID0gQXJyYXkuaXNBcnJheShzb3VyY2UpO1xuXHR2YXIgdGFyZ2V0SXNBcnJheSA9IEFycmF5LmlzQXJyYXkodGFyZ2V0KTtcblx0dmFyIHNvdXJjZUFuZFRhcmdldFR5cGVzTWF0Y2ggPSBzb3VyY2VJc0FycmF5ID09PSB0YXJnZXRJc0FycmF5O1xuXG5cdGlmICghc291cmNlQW5kVGFyZ2V0VHlwZXNNYXRjaCkge1xuXHRcdHJldHVybiBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZChzb3VyY2UsIG9wdGlvbnMpXG5cdH0gZWxzZSBpZiAoc291cmNlSXNBcnJheSkge1xuXHRcdHJldHVybiBvcHRpb25zLmFycmF5TWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpXG5cdH0gZWxzZSB7XG5cdFx0cmV0dXJuIG1lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlLCBvcHRpb25zKVxuXHR9XG59XG5cbmRlZXBtZXJnZS5hbGwgPSBmdW5jdGlvbiBkZWVwbWVyZ2VBbGwoYXJyYXksIG9wdGlvbnMpIHtcblx0aWYgKCFBcnJheS5pc0FycmF5KGFycmF5KSkge1xuXHRcdHRocm93IG5ldyBFcnJvcignZmlyc3QgYXJndW1lbnQgc2hvdWxkIGJlIGFuIGFycmF5Jylcblx0fVxuXG5cdHJldHVybiBhcnJheS5yZWR1Y2UoZnVuY3Rpb24ocHJldiwgbmV4dCkge1xuXHRcdHJldHVybiBkZWVwbWVyZ2UocHJldiwgbmV4dCwgb3B0aW9ucylcblx0fSwge30pXG59O1xuXG52YXIgZGVlcG1lcmdlXzEgPSBkZWVwbWVyZ2U7XG5cbnZhciBjanMgPSBkZWVwbWVyZ2VfMTtcblxudmFyIEZsYXNoZXJGYWN0b3J5ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBGbGFzaGVyRmFjdG9yeSh2aWV3RmFjdG9yeSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lb3V0OiA1MDAwLFxuICAgICAgICAgICAgZnBzOiAzMCxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAndG9wLXJpZ2h0JyxcbiAgICAgICAgICAgIGRpcmVjdGlvbjogJ3RvcCcsXG4gICAgICAgICAgICBzdHlsZToge31cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xuICAgIH1cbiAgICBGbGFzaGVyRmFjdG9yeS5wcm90b3R5cGUuc3VjY2VzcyA9IGZ1bmN0aW9uIChtZXNzYWdlLCB0aXRsZSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLmZsYXNoKCdzdWNjZXNzJywgbWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgRmxhc2hlckZhY3RvcnkucHJvdG90eXBlLmluZm8gPSBmdW5jdGlvbiAobWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5mbGFzaCgnaW5mbycsIG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIEZsYXNoZXJGYWN0b3J5LnByb3RvdHlwZS53YXJuaW5nID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuZmxhc2goJ3dhcm5pbmcnLCBtZXNzYWdlLCB0aXRsZSwgb3B0aW9ucyk7XG4gICAgfTtcbiAgICBGbGFzaGVyRmFjdG9yeS5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5mbGFzaCgnZXJyb3InLCBtZXNzYWdlLCB0aXRsZSwgb3B0aW9ucyk7XG4gICAgfTtcbiAgICBGbGFzaGVyRmFjdG9yeS5wcm90b3R5cGUuZmxhc2ggPSBmdW5jdGlvbiAodHlwZSwgbWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IHRoaXMuY3JlYXRlTm90aWZpY2F0aW9uKHR5cGUsIG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5yZW5kZXJPcHRpb25zKHt9KTtcbiAgICAgICAgdGhpcy5yZW5kZXIoeyBub3RpZmljYXRpb246IG5vdGlmaWNhdGlvbiB9KTtcbiAgICB9O1xuICAgIEZsYXNoZXJGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVOb3RpZmljYXRpb24gPSBmdW5jdGlvbiAodHlwZSwgbWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0eXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgb3B0aW9ucyA9IHR5cGU7XG4gICAgICAgICAgICB0eXBlID0gb3B0aW9ucy50eXBlO1xuICAgICAgICAgICAgbWVzc2FnZSA9IG9wdGlvbnMubWVzc2FnZTtcbiAgICAgICAgICAgIHRpdGxlID0gb3B0aW9ucy50aXRsZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBtZXNzYWdlO1xuICAgICAgICAgICAgbWVzc2FnZSA9IG9wdGlvbnMubWVzc2FnZTtcbiAgICAgICAgICAgIHRpdGxlID0gb3B0aW9ucy50aXRsZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgdGl0bGUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gdGl0bGU7XG4gICAgICAgICAgICB0aXRsZSA9IG9wdGlvbnMudGl0bGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbWVzc2FnZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdtZXNzYWdlIG9wdGlvbiBpcyByZXF1aXJlZCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiB0eXBlIHx8ICdpbmZvJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aXRsZTogdGl0bGUsXG4gICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBGbGFzaGVyRmFjdG9yeS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGVudmVsb3BlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBub3RpZmljYXRpb24gPSBlbnZlbG9wZS5ub3RpZmljYXRpb247XG4gICAgICAgIHZhciBuT3B0aW9ucyA9IG5vdGlmaWNhdGlvbi5vcHRpb25zIHx8IHt9O1xuICAgICAgICB2YXIgb3B0aW9ucyA9IEFycmF5LmlzQXJyYXkobk9wdGlvbnMpID8gdGhpcy5vcHRpb25zIDogY2pzKHRoaXMub3B0aW9ucywgbk9wdGlvbnMpO1xuICAgICAgICB2YXIgb25Db250YWluZXJSZWFkeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBfdGhpcy5jcmVhdGVDb250YWluZXIob3B0aW9ucyk7XG4gICAgICAgICAgICBfdGhpcy5hZGRUb0NvbnRhaW5lcihjb250YWluZXIsIGVudmVsb3BlLCBvcHRpb25zKTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKCdsb2FkaW5nJyAhPT0gZG9jdW1lbnQucmVhZHlTdGF0ZSkge1xuICAgICAgICAgICAgb25Db250YWluZXJSZWFkeSgpO1xuICAgICAgICB9XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBvbkNvbnRhaW5lclJlYWR5KTtcbiAgICB9O1xuICAgIEZsYXNoZXJGYWN0b3J5LnByb3RvdHlwZS5yZW5kZXJPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gY2pzKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgfTtcbiAgICBGbGFzaGVyRmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlQ29udGFpbmVyID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIGNvbnRhaW5lclNlbGVjdG9yID0gXCIuZmwtbWFpbi1jb250YWluZXJbZGF0YS1wb3NpdGlvbj1cXFwiXCIuY29uY2F0KG9wdGlvbnMucG9zaXRpb24sIFwiXFxcIl1cIik7XG4gICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICAgICAgaWYgKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICAgICAgfVxuICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2ZsLW1haW4tY29udGFpbmVyJyk7XG4gICAgICAgIGNvbnRhaW5lci5kYXRhc2V0LnBvc2l0aW9uID0gb3B0aW9ucy5wb3NpdGlvbjtcbiAgICAgICAgT2JqZWN0LmtleXMob3B0aW9ucy5zdHlsZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBjb250YWluZXIgPT09IG51bGwgfHwgY29udGFpbmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb250YWluZXIuc3R5bGUuc2V0UHJvcGVydHkoa2V5LCBvcHRpb25zLnN0eWxlW2tleV0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoY29udGFpbmVyKTtcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICB9O1xuICAgIEZsYXNoZXJGYWN0b3J5LnByb3RvdHlwZS5hZGRUb0NvbnRhaW5lciA9IGZ1bmN0aW9uIChjb250YWluZXIsIGVudmVsb3BlLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9IHRoaXMuc3RyaW5nVG9IVE1MKGVudmVsb3BlLnRlbXBsYXRlIHx8IHRoaXMudmlld0ZhY3RvcnkucmVuZGVyKGVudmVsb3BlKSk7XG4gICAgICAgIHRoaXMuYXBwZW5kTm90aWZpY2F0aW9uKGNvbnRhaW5lciwgdGVtcGxhdGUsIG9wdGlvbnMuZGlyZWN0aW9uKTtcbiAgICAgICAgdGhpcy5yZW5kZXJQcm9ncmVzc0Jhcih0ZW1wbGF0ZSwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2xpY2sodGVtcGxhdGUpO1xuICAgIH07XG4gICAgRmxhc2hlckZhY3RvcnkucHJvdG90eXBlLmFwcGVuZE5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRlbXBsYXRlLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2JvdHRvbScpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmQodGVtcGxhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29udGFpbmVyLnByZXBlbmQodGVtcGxhdGUpO1xuICAgICAgICB9XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGVtcGxhdGUuY2xhc3NMaXN0LmFkZCgnZmwtc2hvdycpO1xuICAgICAgICB9LCAxMDApO1xuICAgIH07XG4gICAgRmxhc2hlckZhY3RvcnkucHJvdG90eXBlLnJlbW92ZU5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICh0ZW1wbGF0ZSkge1xuICAgICAgICB2YXIgY29udGFpbmVyID0gdGVtcGxhdGUucGFyZW50RWxlbWVudDtcbiAgICAgICAgdGVtcGxhdGUuY2xhc3NMaXN0LnJlbW92ZSgnZmwtc2hvdycpO1xuICAgICAgICB0ZW1wbGF0ZS5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGVtcGxhdGUucmVtb3ZlKCk7XG4gICAgICAgICAgICBpZiAoY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBGbGFzaGVyRmFjdG9yeS5wcm90b3R5cGUuaGFuZGxlQ2xpY2sgPSBmdW5jdGlvbiAodGVtcGxhdGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGVtcGxhdGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZW1vdmVOb3RpZmljYXRpb24odGVtcGxhdGUpOyB9KTtcbiAgICB9O1xuICAgIEZsYXNoZXJGYWN0b3J5LnByb3RvdHlwZS5yZW5kZXJQcm9ncmVzc0JhciA9IGZ1bmN0aW9uICh0ZW1wbGF0ZSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAoIW9wdGlvbnMudGltZW91dCB8fCBvcHRpb25zLnRpbWVvdXQgPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgcHJvZ3Jlc3NCYXIuY2xhc3NMaXN0LmFkZCgnZmwtcHJvZ3Jlc3MnKTtcbiAgICAgICAgdmFyIHByb2dyZXNzQmFyQ29udGFpbmVyID0gdGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmZsLXByb2dyZXNzLWJhcicpO1xuICAgICAgICBwcm9ncmVzc0JhckNvbnRhaW5lciAmJiBwcm9ncmVzc0JhckNvbnRhaW5lci5hcHBlbmQocHJvZ3Jlc3NCYXIpO1xuICAgICAgICB2YXIgbGFwc2UgPSAxMDAwIC8gb3B0aW9ucy5mcHM7XG4gICAgICAgIHZhciB3aWR0aCA9IDA7XG4gICAgICAgIHZhciBzaG93UHJvZ3Jlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB3aWR0aCArPSAxO1xuICAgICAgICAgICAgdmFyIHBlcmNlbnQgPSAoMSAtIGxhcHNlICogKHdpZHRoIC8gb3B0aW9ucy50aW1lb3V0KSkgKiAxMDA7XG4gICAgICAgICAgICBwcm9ncmVzc0Jhci5zdHlsZS53aWR0aCA9IFwiXCIuY29uY2F0KHBlcmNlbnQsIFwiJVwiKTtcbiAgICAgICAgICAgIGlmIChwZXJjZW50IDw9IDApIHtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzSW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIF90aGlzLnJlbW92ZU5vdGlmaWNhdGlvbih0ZW1wbGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBwcm9ncmVzc0ludGVydmFsID0gd2luZG93LnNldEludGVydmFsKHNob3dQcm9ncmVzcywgbGFwc2UpO1xuICAgICAgICB0ZW1wbGF0ZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHByb2dyZXNzSW50ZXJ2YWwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoc2hvd1Byb2dyZXNzLCBsYXBzZSk7IH0pO1xuICAgICAgICB0ZW1wbGF0ZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7IHJldHVybiBjbGVhckludGVydmFsKHByb2dyZXNzSW50ZXJ2YWwpOyB9KTtcbiAgICB9O1xuICAgIEZsYXNoZXJGYWN0b3J5LnByb3RvdHlwZS5zdHJpbmdUb0hUTUwgPSBmdW5jdGlvbiAoc3RyKSB7XG4gICAgICAgIHZhciBzdXBwb3J0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghRE9NUGFyc2VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcGFyc2VyLnBhcnNlRnJvbVN0cmluZygneCcsICd0ZXh0L2h0bWwnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSkoKTtcbiAgICAgICAgaWYgKHN1cHBvcnQpIHtcbiAgICAgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgICAgICAgICB2YXIgZG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhzdHIsICd0ZXh0L2h0bWwnKTtcbiAgICAgICAgICAgIHJldHVybiBkb2MuYm9keS5maXJzdENoaWxkO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkb20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZG9tLmlubmVySFRNTCA9IHN0cjtcbiAgICAgICAgcmV0dXJuIGRvbS5maXJzdEVsZW1lbnRDaGlsZDtcbiAgICB9O1xuICAgIHJldHVybiBGbGFzaGVyRmFjdG9yeTtcbn0oKSk7XG5cbnZhciBGbGFzaGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBGbGFzaGVyKCkge1xuICAgICAgICB0aGlzLmRlZmF1bHRIYW5kbGVyID0gJ3RoZW1lLmZsYXNoZXInO1xuICAgICAgICB0aGlzLmZhY3RvcmllcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy50aGVtZXMgPSBuZXcgTWFwKCk7XG4gICAgfVxuICAgIEZsYXNoZXIucHJvdG90eXBlLnN1Y2Nlc3MgPSBmdW5jdGlvbiAobWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5mbGFzaCgnc3VjY2VzcycsIG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIEZsYXNoZXIucHJvdG90eXBlLmluZm8gPSBmdW5jdGlvbiAobWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5mbGFzaCgnaW5mbycsIG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIEZsYXNoZXIucHJvdG90eXBlLndhcm5pbmcgPSBmdW5jdGlvbiAobWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5mbGFzaCgnd2FybmluZycsIG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIEZsYXNoZXIucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuZmxhc2goJ2Vycm9yJywgbWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgRmxhc2hlci5wcm90b3R5cGUuZmxhc2ggPSBmdW5jdGlvbiAodHlwZSwgbWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IHRoaXMuY3JlYXRlTm90aWZpY2F0aW9uKHR5cGUsIG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKTtcbiAgICAgICAgdmFyIGZhY3RvcnkgPSB0aGlzLmNyZWF0ZSh0aGlzLmRlZmF1bHRIYW5kbGVyKTtcbiAgICAgICAgZmFjdG9yeS5yZW5kZXJPcHRpb25zKHt9KTtcbiAgICAgICAgZmFjdG9yeS5yZW5kZXIoeyBub3RpZmljYXRpb246IG5vdGlmaWNhdGlvbiB9KTtcbiAgICB9O1xuICAgIEZsYXNoZXIucHJvdG90eXBlLmNyZWF0ZU5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICh0eXBlLCBtZXNzYWdlLCB0aXRsZSwgb3B0aW9ucykge1xuICAgICAgICBpZiAodHlwZW9mIHR5cGUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gdHlwZTtcbiAgICAgICAgICAgIHR5cGUgPSBvcHRpb25zLnR5cGU7XG4gICAgICAgICAgICBtZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlO1xuICAgICAgICAgICAgdGl0bGUgPSBvcHRpb25zLnRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgb3B0aW9ucyA9IG1lc3NhZ2U7XG4gICAgICAgICAgICBtZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlO1xuICAgICAgICAgICAgdGl0bGUgPSBvcHRpb25zLnRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiB0aXRsZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSB0aXRsZTtcbiAgICAgICAgICAgIHRpdGxlID0gb3B0aW9ucy50aXRsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodW5kZWZpbmVkID09PSBtZXNzYWdlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21lc3NhZ2Ugb3B0aW9uIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6IHR5cGUgfHwgJ2luZm8nLFxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIEZsYXNoZXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChhbGlhcykge1xuICAgICAgICBhbGlhcyA9IHRoaXMucmVzb2x2ZUhhbmRsZXIoYWxpYXMpO1xuICAgICAgICB0aGlzLnJlc29sdmVUaGVtZUhhbmRsZXIoYWxpYXMpO1xuICAgICAgICB2YXIgZmFjdG9yeSA9IHRoaXMuZmFjdG9yaWVzLmdldChhbGlhcyk7XG4gICAgICAgIGlmICghZmFjdG9yeSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIHJlc29sdmUgXFxcIlwiLmNvbmNhdChhbGlhcywgXCJcXFwiIG5vdGlmaWNhdGlvbiBmYWN0b3J5LCBkaWQgeW91IGZvcmdldCB0byByZWdpc3RlciBpdD9cIikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWN0b3J5O1xuICAgIH07XG4gICAgRmxhc2hlci5wcm90b3R5cGUucmVuZGVyT3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKG9wdGlvbnMpLmZvckVhY2goZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICB2YXIgaGFuZGxlciA9IF9hWzBdLCBvcHRpb24gPSBfYVsxXTtcbiAgICAgICAgICAgIF90aGlzLmNyZWF0ZShoYW5kbGVyKS5yZW5kZXJPcHRpb25zKG9wdGlvbik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgRmxhc2hlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJlc3BvbnNlID0gdGhpcy5yZXNvbHZlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICB0aGlzLmFkZFN0eWxlcyhyZXNwb25zZS5zdHlsZXMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLmFkZFNjcmlwdHMocmVzcG9uc2Uuc2NyaXB0cywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLnJlbmRlck9wdGlvbnMocmVzcG9uc2Uub3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgX3RoaXMucmVuZGVyRW52ZWxvcGVzKHJlc3BvbnNlLmVudmVsb3BlcywgcmVzcG9uc2UuY29udGV4dCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBGbGFzaGVyLnByb3RvdHlwZS5hZGRGYWN0b3J5ID0gZnVuY3Rpb24gKG5hbWUsIGZhY3RvcnkpIHtcbiAgICAgICAgdGhpcy5mYWN0b3JpZXMuc2V0KG5hbWUsIGZhY3RvcnkpO1xuICAgIH07XG4gICAgRmxhc2hlci5wcm90b3R5cGUuYWRkVGhlbWUgPSBmdW5jdGlvbiAobmFtZSwgdGhlbWUpIHtcbiAgICAgICAgdGhpcy50aGVtZXMuc2V0KG5hbWUsIHRoZW1lKTtcbiAgICB9O1xuICAgIEZsYXNoZXIucHJvdG90eXBlLnVzaW5nID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdGhpcy5kZWZhdWx0SGFuZGxlciA9IG5hbWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgRmxhc2hlci5wcm90b3R5cGUuYWRkU3R5bGVzID0gZnVuY3Rpb24gKHVybHMsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh1cmxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJsaW5rW2hyZWY9XFxcIlwiLmNvbmNhdCh1cmxzWzBdLCBcIlxcXCJdXCIpKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5hZGRTdHlsZXModXJscy5zbGljZSgxKSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7XG4gICAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB1cmxzWzBdKTtcbiAgICAgICAgdGFnLnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0L2NzcycpO1xuICAgICAgICB0YWcuc2V0QXR0cmlidXRlKCdyZWwnLCAnc3R5bGVzaGVldCcpO1xuICAgICAgICB0YWcub25sb2FkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuYWRkU3R5bGVzKHVybHMuc2xpY2UoMSksIGNhbGxiYWNrKTsgfTtcbiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCh0YWcpO1xuICAgIH07XG4gICAgRmxhc2hlci5wcm90b3R5cGUuYWRkU2NyaXB0cyA9IGZ1bmN0aW9uICh1cmxzLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodXJscy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwic2NyaXB0W3NyYz1cXFwiXCIuY29uY2F0KHVybHNbMF0sIFwiXFxcIl1cIikpICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmFkZFNjcmlwdHModXJscy5zbGljZSgxKSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgdGFnLnNldEF0dHJpYnV0ZSgnc3JjJywgdXJsc1swXSk7XG4gICAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dC9qYXZhc2NyaXB0Jyk7XG4gICAgICAgIHRhZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5hZGRTY3JpcHRzKHVybHMuc2xpY2UoMSksIGNhbGxiYWNrKTsgfTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0YWcpO1xuICAgIH07XG4gICAgRmxhc2hlci5wcm90b3R5cGUucmVuZGVyRW52ZWxvcGVzID0gZnVuY3Rpb24gKGVudmVsb3BlcywgY29udGV4dCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgcXVldWVzID0gbmV3IE1hcCgpO1xuICAgICAgICBlbnZlbG9wZXMuZm9yRWFjaChmdW5jdGlvbiAoZW52ZWxvcGUpIHtcbiAgICAgICAgICAgIGVudmVsb3BlLmNvbnRleHQgPSBPYmplY3QuYXNzaWduKHt9LCBlbnZlbG9wZS5jb250ZXh0IHx8IHt9LCBjb250ZXh0KTtcbiAgICAgICAgICAgIGVudmVsb3BlLmhhbmRsZXIgPSBfdGhpcy5yZXNvbHZlSGFuZGxlcihlbnZlbG9wZS5oYW5kbGVyKTtcbiAgICAgICAgICAgIHZhciBmYWN0b3J5ID0gX3RoaXMuY3JlYXRlKGVudmVsb3BlLmhhbmRsZXIpO1xuICAgICAgICAgICAgaWYgKCFfdGhpcy5pc1F1ZXVlYWJsZShmYWN0b3J5KSkge1xuICAgICAgICAgICAgICAgIGZhY3RvcnkucmVuZGVyKGVudmVsb3BlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBxdWV1ZXMuZ2V0KGVudmVsb3BlLmhhbmRsZXIpIHx8IGZhY3RvcnkucmVzZXRRdWV1ZSgpO1xuICAgICAgICAgICAgZmFjdG9yeS5hZGRFbnZlbG9wZShlbnZlbG9wZSk7XG4gICAgICAgICAgICBxdWV1ZXMuc2V0KGVudmVsb3BlLmhhbmRsZXIsIGZhY3RvcnkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcXVldWVzLmZvckVhY2goZnVuY3Rpb24gKGZhY3RvcnkpIHsgcmV0dXJuIGZhY3RvcnkucmVuZGVyUXVldWUoKTsgfSk7XG4gICAgfTtcbiAgICBGbGFzaGVyLnByb3RvdHlwZS5pc1F1ZXVlYWJsZSA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmplY3QuYWRkRW52ZWxvcGUgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICYmIHR5cGVvZiBvYmplY3QucmVuZGVyUXVldWUgPT09ICdmdW5jdGlvbic7XG4gICAgfTtcbiAgICBGbGFzaGVyLnByb3RvdHlwZS5yZXNvbHZlUmVzcG9uc2UgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmVzcG9uc2UuZW52ZWxvcGVzID0gcmVzcG9uc2UuZW52ZWxvcGVzIHx8IFtdO1xuICAgICAgICByZXNwb25zZS5vcHRpb25zID0gcmVzcG9uc2Uub3B0aW9ucyB8fCB7fTtcbiAgICAgICAgcmVzcG9uc2Uuc2NyaXB0cyA9IHJlc3BvbnNlLnNjcmlwdHMgfHwgW107XG4gICAgICAgIHJlc3BvbnNlLnN0eWxlcyA9IHJlc3BvbnNlLnN0eWxlcyB8fCBbXTtcbiAgICAgICAgcmVzcG9uc2UuY29udGV4dCA9IHJlc3BvbnNlLmNvbnRleHQgfHwge307XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKHJlc3BvbnNlLm9wdGlvbnMpLmZvckVhY2goZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICB2YXIgaGFuZGxlciA9IF9hWzBdLCBvcHRpb25zID0gX2FbMV07XG4gICAgICAgICAgICByZXNwb25zZS5vcHRpb25zW2hhbmRsZXJdID0gX3RoaXMucGFyc2VPcHRpb25zKG9wdGlvbnMpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVzcG9uc2UuZW52ZWxvcGVzLmZvckVhY2goZnVuY3Rpb24gKGVudmVsb3BlKSB7XG4gICAgICAgICAgICBlbnZlbG9wZS5oYW5kbGVyID0gX3RoaXMucmVzb2x2ZUhhbmRsZXIoZW52ZWxvcGUuaGFuZGxlcik7XG4gICAgICAgICAgICBlbnZlbG9wZS5ub3RpZmljYXRpb24ub3B0aW9ucyA9IF90aGlzLnBhcnNlT3B0aW9ucyhlbnZlbG9wZS5ub3RpZmljYXRpb24ub3B0aW9ucyB8fCB7fSk7XG4gICAgICAgICAgICBfdGhpcy5wdXNoU3R5bGVzKHJlc3BvbnNlLCBlbnZlbG9wZS5oYW5kbGVyKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9O1xuICAgIEZsYXNoZXIucHJvdG90eXBlLnBhcnNlT3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKG9wdGlvbnMpLmZvckVhY2goZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICB2YXIga2V5ID0gX2FbMF0sIHZhbHVlID0gX2FbMV07XG4gICAgICAgICAgICBvcHRpb25zW2tleV0gPSBfdGhpcy5wYXJzZUZ1bmN0aW9uKHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBvcHRpb25zO1xuICAgIH07XG4gICAgRmxhc2hlci5wcm90b3R5cGUucGFyc2VGdW5jdGlvbiA9IGZ1bmN0aW9uIChmdW5jKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGlmICh0eXBlb2YgZnVuYyAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtYXRjaCA9IGZ1bmMubWF0Y2goL15mdW5jdGlvbig/Oi4rKT8oPzpcXHMrKT9cXCgoLispP1xcKSg/Olxccyt8XFxuKyk/eyg/Olxccyt8XFxuKyk/KCg/Oi58XFxuKSspfSQvbSk7XG4gICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhcmdzID0gKF9iID0gKF9hID0gbWF0Y2hbMV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbiAoYXJnKSB7IHJldHVybiBhcmcudHJpbSgpOyB9KSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW107XG4gICAgICAgIHZhciBib2R5ID0gbWF0Y2hbMl07XG4gICAgICAgIHJldHVybiBuZXcgKEZ1bmN0aW9uLmJpbmQuYXBwbHkoRnVuY3Rpb24sIF9fc3ByZWFkQXJyYXkoX19zcHJlYWRBcnJheShbdm9pZCAwXSwgYXJncywgZmFsc2UpLCBbYm9keV0sIGZhbHNlKSkpKCk7XG4gICAgfTtcbiAgICBGbGFzaGVyLnByb3RvdHlwZS5wdXNoU3R5bGVzID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBoYW5kbGVyKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgaGFuZGxlciA9IGhhbmRsZXIucmVwbGFjZSgndGhlbWUuJywgJycpO1xuICAgICAgICB2YXIgc3R5bGVzID0gKChfYSA9IHRoaXMudGhlbWVzLmdldChoYW5kbGVyKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0eWxlcykgfHwgW107XG4gICAgICAgIHJlc3BvbnNlLnN0eWxlcyA9IHJlc3BvbnNlLnN0eWxlc1xuICAgICAgICAgICAgLmNvbmNhdChzdHlsZXMpXG4gICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uICh2YWx1ZSwgaW5kZXgsIHNlbGYpIHsgcmV0dXJuIHNlbGYuaW5kZXhPZih2YWx1ZSkgPT09IGluZGV4OyB9KTtcbiAgICB9O1xuICAgIEZsYXNoZXIucHJvdG90eXBlLnJlc29sdmVIYW5kbGVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgaGFuZGxlciA9IGhhbmRsZXIgfHwgdGhpcy5kZWZhdWx0SGFuZGxlcjtcbiAgICAgICAgaWYgKFsnZmxhc2hlcicsICd0aGVtZScsICd0ZW1wbGF0ZSddLmluY2x1ZGVzKGhhbmRsZXIpKSB7XG4gICAgICAgICAgICBoYW5kbGVyID0gJ3RoZW1lLmZsYXNoZXInO1xuICAgICAgICB9XG4gICAgICAgIGhhbmRsZXIgPSBoYW5kbGVyLnJlcGxhY2UoJ3RlbXBsYXRlLicsICd0aGVtZS4nKTtcbiAgICAgICAgcmV0dXJuIGhhbmRsZXI7XG4gICAgfTtcbiAgICBGbGFzaGVyLnByb3RvdHlwZS5yZXNvbHZlVGhlbWVIYW5kbGVyID0gZnVuY3Rpb24gKGFsaWFzKSB7XG4gICAgICAgIGlmICgwICE9PSBhbGlhcy5pbmRleE9mKCd0aGVtZS4nKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB2aWV3RmFjdG9yeSA9IHRoaXMudGhlbWVzLmdldChhbGlhcy5yZXBsYWNlKCd0aGVtZS4nLCAnJykpO1xuICAgICAgICBpZiAoIXZpZXdGYWN0b3J5KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hZGRGYWN0b3J5KGFsaWFzLCBuZXcgRmxhc2hlckZhY3Rvcnkodmlld0ZhY3RvcnkpKTtcbiAgICB9O1xuICAgIHJldHVybiBGbGFzaGVyO1xufSgpKTtcblxudmFyIGZsYXNoZXIgPSBuZXcgRmxhc2hlcigpO1xuZmxhc2hlci5hZGRUaGVtZSgnZmxhc2hlcicsIHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uIChlbnZlbG9wZSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHZhciBub3RpZmljYXRpb24gPSBlbnZlbG9wZS5ub3RpZmljYXRpb247XG4gICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImZsLWZsYXNoZXIgZmwtY29udGFpbmVyIGZsLScgKyBub3RpZmljYXRpb24udHlwZSArICdcIj4nICtcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZmwtY29udGVudFwiPicgK1xuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJmbC1pY29uXCI+PC9kaXY+JyArXG4gICAgICAgICAgICAnPGRpdj4nICtcbiAgICAgICAgICAgICc8c3Ryb25nIGNsYXNzPVwiZmwtdGl0bGVcIj4nICsgKChfYSA9IG5vdGlmaWNhdGlvbi50aXRsZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbm90aWZpY2F0aW9uLnR5cGUpICsgJzwvc3Ryb25nPicgK1xuICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZmwtbWVzc2FnZVwiPicgKyBub3RpZmljYXRpb24ubWVzc2FnZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJmbC1wcm9ncmVzcy1iYXJcIj48L3NwYW4+JyArXG4gICAgICAgICAgICAnPC9kaXY+JztcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBmbGFzaGVyO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9